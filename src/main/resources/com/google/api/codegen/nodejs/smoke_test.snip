@extends "nodejs/method_sample.snip"

@snippet generate(smokeTest)
  {@header(smokeTest.fileHeader)}

  {@smokeTest(smokeTest)}
@end

@private header(fileHeader)
  /*
   {@comments(fileHeader.copyrightLines)}
   *
   {@comments(fileHeader.licenseLines)}
   */
  'use strict';
@end

@private smokeTest(smokeTest)
  describe('{@smokeTest.name}', function() {
    @if smokeTest.requireProjectId
      if (!process.env.SMOKE_TEST_PROJECT) {
        throw new Error("Usage: SMOKE_TEST_PROJECT=<project_id> node #{$0}");
      }
      var projectId = process.env.SMOKE_TEST_PROJECT;
    @end

    @switch smokeTest.apiMethod.type.toString
    @case "PagedOptionalArrayMethod"
      # Add the streaming call for page streaming.
      {@smokeTestBody(smokeTest, \
        "successfully makes a call to the service using streaming", \
        {sampleCodePageStreaming(smokeTest.apiMethod, mochaCompletedCallback())})}
    @default
    @end
    {@smokeTestBody(smokeTest, \
        "successfully makes a call to the service", \
        {@sampleCode(smokeTest.apiMethod, mochaCompletedCallback()))}}
  });
@end

@private smokeTestBody(smokeTest, description, sampleCode)
 it('{@description}', function({@mochaCompletedCallback()}) {
   {@decorateSampleCode(smokeTest.apiMethod, {@sampleCode})}
 });
@end

@private mochaCompletedCallback()
  done
@end
